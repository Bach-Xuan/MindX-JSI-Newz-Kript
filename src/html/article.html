<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newz Kript</title>
    <link rel="icon" type="image/x-icon" href="../assets/favicon/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/back-to-top.css">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/favorite.css">
    <link rel="stylesheet" href="../css/comment.css">
    <link rel="stylesheet" href="../css/footer.css">
    <style>
        /* Additional CSS for comments */
        #comments-wrapper {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        #comments-header {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        #comments-list {
            list-style: none;
            padding: 0;
            margin: 0 0 2rem 0;
        }

        .comment-item {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .comment-author {
            color: #4a73e8;
            font-size: 0.9rem;
        }

        .comment-date {
            color: #6c757d;
            font-size: 0.8rem;
        }

        .comment-content {
            margin-bottom: 0.5rem;
            line-height: 1.5;
        }

        .comment-actions {
            display: flex;
            gap: 0.5rem;
        }

        .reply-button {
            background: none;
            border: none;
            color: #4a73e8;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .reply-button:hover:not(:disabled) {
            background-color: #e7f1ff;
        }

        .reply-button:disabled {
            color: #6c757d;
            cursor: not-allowed;
        }

        .replies-list {
            list-style: none;
            padding: 0;
            margin: 1rem 0 0 2rem;
        }

        .reply-item {
            background: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .reply-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .reply-author {
            color: #4a73e8;
            font-size: 0.85rem;
        }

        .reply-date {
            color: #6c757d;
            font-size: 0.75rem;
        }

        .reply-content {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .reply-form {
            margin: 1rem 0;
            padding: 1rem;
            background: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 6px;
        }

        .reply-input {
            width: 100%;
            min-height: 80px;
            padding: 0.75rem;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            resize: vertical;
            font-family: inherit;
            font-size: 0.9rem;
        }

        .reply-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .reply-submit,
        .reply-cancel {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background-color 0.2s;
        }

        .reply-submit {
            background: #4a73e8;
            color: white;
        }

        .reply-submit:hover {
            background: #3d5dcc;
        }

        .reply-cancel {
            background: #6c757d;
            color: white;
        }

        .reply-cancel:hover {
            background: #5a6268;
        }

        #comment-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        #comment-input {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            resize: vertical;
            font-family: inherit;
            font-size: 1rem;
        }

        #comment-submit {
            align-self: flex-start;
            padding: 0.75rem 1.5rem;
            background: #4a73e8;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
        }

        #comment-submit:hover {
            background: #3d5dcc;
        }

        .no-comments,
        .error-message {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
            font-style: italic;
        }

        .login-message {
            text-align: center;
            padding: 1rem;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            margin-bottom: 1rem;
        }

        .login-message a {
            color: #4a73e8;
            text-decoration: none;
        }

        .login-message a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            #comments-wrapper {
                margin: 1rem auto;
                padding: 0 0.5rem;
            }

            .replies-list {
                margin-left: 1rem;
            }

            .comment-header,
            .reply-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }

            .reply-actions {
                flex-direction: column;
            }

            .reply-submit,
            .reply-cancel {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <header>
        <nav class="nav-main">
            <a href="../../index.html" id="brand"><img src="../assets/img/logo.jpg">NEWZ KRIPT</a>
            <div id="searchContainer">
                <div class="search-wrapper">
                    <input type="text" id="searchInput" placeholder="Search...">
                    <div class="search-btn"></div>
                    <i class="fa-solid fa-magnifying-glass"></i>
                </div>
            </div>
            <div id="resultsContainer" class="results-container" id="resultsContainer"></div>
            <button id="login"><i class="fa-regular fa-user"></i></button>
        </nav>
    </header>
    <div class="gcse-search"></div>
    <nav class="nav-sub">
        <div class="nav-sub-container">
            <a href="#">WORLD</a>
            <a href="#">BUSINESS</a>
            <a href="#">HEALTH</a>
            <a href="#">EDUCATION</a>
            <a href="#">TECHNOLOGY</a>
            <a href="#">SCIENCE</a>
            <a href="#">SPORTS</a>
            <a href="#">ENTERTAINMENT</a>
        </div>
    </nav>
    <button id="backToTop">
        <i class="fa-solid fa-play fa-rotate-270 fa-xl" style="color: #4a73e8;"></i>
    </button>

    <!-- WEATHER WIDGET -->
    <section class="weather-widget">
        <script>
            (function (d, s, id) {
                if (d.getElementById(id)) {
                    if (window.__TOMORROW__) {
                        window.__TOMORROW__.renderWidget();
                    }
                    return;
                }
                const fjs = d.getElementsByTagName(s)[0];
                const js = d.createElement(s);
                js.id = id;
                js.src = "https://www.tomorrow.io/v1/widget/sdk/sdk.bundle.min.js";

                fjs.parentNode.insertBefore(js, fjs);
            })(document, 'script', 'tomorrow-sdk');
        </script>

        <div class="tomorrow" data-location-id="" data-language="EN" data-unit-system="METRIC" data-skin="light"
            data-widget-type="upcoming" style="padding-bottom:22px;position:relative;">
            <a href="https://www.tomorrow.io/weather-api/" rel="nofollow noopener noreferrer" target="_blank"
                style="position: absolute; bottom: 0; transform: translateX(-50%); left: 50%;">
                <img alt="Powered by the Tomorrow.io Weather API"
                    src="https://weather-website-client.tomorrow.io/img/powered-by.svg" width="250" height="18" />
            </a>
        </div>
    </section>

    <main>
        <!-- ARTICLE CONTENT -->
        <section class="article-content">
            <h1 id="article-title"></h1>
            <p id="article-author"></p>
            <p id="article-published"></p>
            <img id="article-image" src="" loading="lazy">
            <p id="article-description"></p>
            <div id="article-content"></div>
            <a id="article-link" href="" target="_blank">Read Full Article</a>
        </section>
        <!-- FAVORITE SECTION -->
        <div class="favorite-section">
            <button id="favBtn" class="fav-btn" title="Add to favorites">
                <i class="far fa-star"></i>
            </button>
            <p class="favorite-text">Save this article to your favorites</p>
        </div>
    </main>

    <!-- Comments Feature -->
    <section id="comments-wrapper">
        <header id="comments-header">💬 Comments</header>
        <ul id="comments-list"></ul>
        <form id="comment-form">
            <textarea id="comment-input" placeholder="Share your thoughts…" required></textarea>
            <button id="comment-submit" type="submit">Post Comment</button>
        </form>
    </section>

    <footer>
        <div class="footer-brand">
            <img src="../assets/img/logo.jpg">
            NEWZ KRIPT
        </div>

        <div class="footer-links">
            <a href="#">PRIVACY POLICY</a>
            <a href="#">TERMS OF SERVICE</a>
            <a href="#">CONTACT US</a>
        </div>
    </footer>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const article = JSON.parse(localStorage.getItem('selectedArticle'));

            if (article) {
                // Display article content
                document.getElementById('article-title').textContent = article.title || 'Untitled';
                document.getElementById('article-author').textContent = `By ${article.creator || article.author || 'Unknown Author'}`;

                // Format date
                let dateStr = 'Date not available';
                if (article.pubDate) {
                    try {
                        dateStr = new Date(article.pubDate).toLocaleDateString();
                    } catch (e) {
                        dateStr = article.pubDate;
                    }
                }
                document.getElementById('article-published').textContent = dateStr;

                document.getElementById('article-image').src = article.image_url || './image/800x400.png';
                document.getElementById('article-description').textContent = article.description || '';

                // Handle content formatting
                const contentEl = document.getElementById('article-content');
                if (article.content) {
                    // Convert line breaks to paragraphs for better formatting
                    const formattedContent = article.content
                        .split('\n')
                        .filter(paragraph => paragraph.trim())
                        .map(paragraph => `<p>${paragraph.trim()}</p>`)
                        .join('');
                    contentEl.innerHTML = formattedContent;
                } else {
                    contentEl.innerHTML = '<p>Content not available.</p>';
                }

                // Set article link
                const linkEl = document.getElementById('article-link');
                if (article.link) {
                    linkEl.href = article.link;
                    linkEl.style.display = 'inline-block';
                } else {
                    linkEl.style.display = 'none';
                }

                // Update page title
                document.title = article.title || 'Article - Newz Kript';
            } else {
                document.body.innerHTML = '<div style="text-align: center; padding: 50px;"><h2>Article not found</h2><p>Please go back and select an article.</p><button onclick="window.history.back()" style="background: #4a73e8; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Go Back</button></div>';
            }
        });
    </script>

    <!-- Load scripts in correct order -->
    <script type="module" src="../js/firebase-config.js"></script>
    <script type="module" src="../js/comment.js"></script>
    <script type="module" src="../js/article.js"></script>
    <script type="module" src="../js/favorite.js"></script>
    <script src="../js/back-to-top.js" defer></script>
</body>

</html>